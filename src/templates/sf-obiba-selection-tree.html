<div
  class="form-group st-form-group"
  ng-class="{'has-error': form.disableErrorState !== true && hasError(), 'has-success': form.disableSuccessState !== true && hasSuccess(), 'has-feedback': form.feedback !== false }"
  ng-controller="sfObibaSelectionTreeController"
  schema-validate="form"
  sf-field-model>
  <label ng-if="!form.notitle" class="control-label" >{{form.title}}</label>

  <div ng-if="isSingle" class="st-head">
    <span ng-class="ngModel.$modelValue ? 'st-selection' : 'st-no-selection' ">{{ ngModel.$modelValue || form.schema.noSelectionLabel || 'No selection' }}</span>
    <button ng-if="!form.readonly" ng-click="toggleShowTree()" class="st-selector btn btn-sm btn-default" type="button">{{ form.schema.selectLabel || 'Select' }}</button>
  </div>

  <div ng-show="!isSingle || showTree" ng-class="'st-card-' + form.schema.type">

    <div class="st-card-section">
      <div ng-if="isSingle" ng-click="toggleShowTree()" class="st-card-header">
        <span>{{ ngModel.$modelValue || form.schema.noSelectionLabel || 'No selection' }}</span>
        <i class="glyphicon glyphicon-remove st-close"></i>
      </div>
      <div ng-if="isSingle && form.schema.selectionTipLabel" class="st-card-help">
        <p class="help-block">{{ form.schema.selectionTipLabel }}</p>
      </div>
      <div class="row">
        <div ng-class="{'col-12 col-xs-12': !nodeDescriptionShown, 'col-5 col-xs-5': nodeDescriptionShown}" class="st-card-body">
          <div class="input-group" ng-hide="form.schema.noFilter" style="max-width: 200px" class="st-filter">
            <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
            <input type="text" class="form-control" ng-model="text">
          </div>
          <sf-obiba-selection-tree-node
            ng-repeat="node in form.schema.nodes | treeFilter:text"
            node="node"
            selections="selections"
            text-filter="text"
            single="isSingle"
            on-toggle-children-selections="onSelectionUpdate(selections)"
            on-toggle-description="toggleNodeDescription(node)"
            readonly="form.readonly"
            class="st-tree">
          </sf-obiba-selection-tree-node>
        </div>
    
        <div ng-show="nodeDescriptionShown" class="col-7 col-xs-7">
          <div class="st-description">
            <div class="st-description-head help-block">
              <span>{{ nodeDescriptionShown }}</span>
            </div>
            <div ng-bind-html="renderedDescription" class="st-description-body"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  <span class="help-block" sf-message="form.helpvalue || form.description"></span>
</div>