angular.module("sfObibaSelectionTreeTemplates",[]).run(["$templateCache",function(e){e.put("src/templates/sf-obiba-selection-tree-node.html",'<div class="col-xs-12">\n  <button ng-click="$ctrl.toggleNode()" class="btn btn-sm btn-link" type="button">\n    <i class="glyphicon" ng-show="!$ctrl.isLeaf" ng-class="{\'glyphicon-menu-right\': !$ctrl.isOpen, \'glyphicon-menu-down\': $ctrl.isOpen}"></i>\n    <div ng-show="$ctrl.isLeaf" style="width: 1em;"></div>\n  </button>\n\n  <input ng-show="!$ctrl.readonly" type="checkbox" name="{{$ctrl.currentNodePath}}" ng-model="$ctrl.selections[$ctrl.currentNodePath]" ng-change="$ctrl.toggleNodeSelection()">\n\n  <span style="margin-left: 1em;">\n    <i class="glyphicon" ng-class="{\'glyphicon-folder-open\': !$ctrl.isLeaf, \'glyphicon-file\': $ctrl.isLeaf}" style="margin-right: 0.5em;"></i>\n    {{$ctrl.currentNodeTitle}}\n\n    <button ng-show="$ctrl.hasAttributes" ng-click="$ctrl.toggleAttributes()" class="btn btn-sm btn-link" type="button">\n      <i class="glyphicon glyphicon-asterisk"></i>\n    </button>\n  </span>\n\n  <div ng-show="!$ctrl.isLeaf && $ctrl.isOpen" class="row" style="margin-left: 1.25em;">\n    <sf-obiba-selection-tree-node\n      ng-repeat="node in $ctrl.currentNode.nodes"\n      node="node"\n      selections="$ctrl.selections"\n      parent-node="$ctrl.currentNode"\n      on-toggle-children-selections="$ctrl.toggleChildrenSelections(selections)"\n      readonly="$ctrl.readonly">\n    </sf-obiba-selection-tree-node>\n  </div>\n</div>'),e.put("src/templates/sf-obiba-selection-tree.html",'<div\n  class="form-group"\n  ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }"\n  ng-controller="sfObibaSelectionTreeController"\n  schema-validate="form"\n  sf-field-model>\n  <label ng-if="!form.notitle" class="control-label" >{{form.title}}</label>\n\n  <div class="row">\n    <sf-obiba-selection-tree-node\n      ng-repeat="node in form.schema.nodes"\n      node="node"\n      selections="selections"\n      on-toggle-children-selections="onSelectionUpdate(selections)"\n      readonly="form.readonly">\n    </sf-obiba-selection-tree-node>\n  </div>\n\n  <span class="help-block" sf-message="form.helpvalue"></span>\n</div>')}]),angular.module("sfObibaSelectionTree",["schemaForm","sfObibaSelectionTreeTemplates","ngObiba"]).config(["schemaFormProvider","schemaFormDecoratorsProvider","sfBuilderProvider","sfPathProvider",function(e,n,t,o){function l(n,t,l){if("array"===t.type&&"obibaSelectionTree"===t.format){var r=e.stdFormObj(n,t,l);return r.key=l.path,r.type="obibaSelectionTree",r.multiple="multiple",l.lookup[o.stringify(l.path)]=r,r}}e.defaults.array.unshift(l),n.defineAddOn("bootstrapDecorator","obibaSelectionTree","src/templates/sf-obiba-selection-tree.html",t.stdBuilders)}]).component("sfObibaSelectionTreeNode",{bindings:{node:"<",selections:"<",readonly:"<",parentNode:"<",onToggleChildrenSelections:"&"},templateUrl:"src/templates/sf-obiba-selection-tree-node.html",controller:function(){function e(e){e.node&&e.node.currentValue&&e.node.currentValue.path&&(r.currentNode=e.node.currentValue,r.currentNodePath=r.node.path,r.currentNodeTitle=r.node.title||r.node.path,r.isLeaf=r.node&&"d"!==r.node.type&&(!Array.isArray(r.node.nodes)||0===r.node.nodes.length),r.hasAttributes=r.node&&r.attributes)}function n(){r.isOpen=!r.isOpen}function t(){r.attributesAreOpen=!r.attributesAreOpen}function o(e){r.onToggleChildrenSelections({selections:e})}function l(e){if(e)("d"===e.type||Array.isArray(e.nodes)&&e.nodes.length>0)&&e.nodes.forEach(function(e){r.selections[e.path]=r.selections[r.currentNodePath]});else{if(r.isLeaf||r.currentNode.nodes.forEach(function(e){r.selections[e.path]=r.selections[r.currentNodePath],l(e)}),r.parentNode&&Array.isArray(r.parentNode.nodes)){var n=r.parentNode.nodes.filter(function(e){return r.selections[e.path]}).length;r.selections[r.parentNode.path]=n===r.parentNode.nodes.length}r.toggleChildrenSelections(r.selections)}}const r=this;r.$onChanges=e,r.toggleNode=n,r.toggleChildrenSelections=o,r.toggleNodeSelection=l,r.toggleAttributes=t}}).controller("sfObibaSelectionTreeController",["$scope",function(e){function n(){var n=Object.keys(e.selections);if(n&&n.length>0){var t=e.model[e.form.key]||[];t.length=0;var o=n.filter(function(n){return e.selections[n]});e.ngModel.$setViewValue(o),o.forEach(function(e){t.push(e)}),e.model[e.form.key]=t}}e.selections={},e.onSelectionUpdate=n}]);